---
title: "Windows 内部"
---

WinMain

## 型
ハンガリアン記法
- `Pxx / LPxx` -> `* (pointer)`
	- `char *` -> `PCHAR`
- `Cxx -> const`
	- `const char *` -> `LPCSTR`
- `Wxx` -> ワイド文字: Unicodeのみの文字型
- `Txx` -> マルチバイト文字: UnicodeやSJISなどより一般の文字型
- `Hxx` -> HANDLE
- `Ixx` / `Nxx` -> 整数

[Windows Data Types (BaseTsd.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/winprog/windows-data-types)

## Windows API (Win32 API)
何ができる？
ファイル読み書き
ディスク読み取り
メモリ

仕組み
DLL内のAPIを呼び出すことで詳細を知ることなくリソースを知ることができる.

1. CreateFileA を呼び出す.
2. kernel32.dll / ntdll.dll から sysenter / syscall してカーネルへ渡す.
3. ntoskrnl.exe が実際にファイル作成する.

利用
- API 名を Google や [Microsoft Learn](https://learn.microsoft.com/en-us/) で検索
- 引数の型情報

## Registry

| 名前               | 略称 | 説明                                               |
| ------------------ | ---- | -------------------------------------------------- |
| HKEY_CURRENT_USER  | HKCU | 現在ログオン中のユーザに関連づけられたデータを格納 |
| HKEY_LOCAL_MACHINE | HKLM | システム関連の情報を格納                           |
| HKEY_USERS         | HKU  | マシン上の全てのユーザに関する情報を格納           |
| HKEY_CLASSES_ROOT  | HKCR | ファイルの関連付け情報などを格納                   |

- [Predefined Keys - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/sysinfo/predefined-keys)

## Heap

RtlCreateHeap 関数は `_HEAP` 構造体へのポインタを返す.
- [Terminus Project - _HEAP - combined view (rewolf.pl)](http://terminus.rewolf.pl/terminus/structures/ntdll/_HEAP_combined.html)
- [Windows 10 Segment Heap Internals (blackhat.com)](https://www.blackhat.com/docs/us-16/materials/us-16-Yason-Windows-10-Segment-Heap-Internals-wp.pdf)